# 成章写作 - 会员系统 + 虚拟货币系统实现文档

## 📋 系统概述

### 核心设计理念
- **虚拟货币名称**：成长积分（KSJ币）
- **会员制度**：订阅制（幸福岛6年会员 ¥3999）
- **积分体系**：有意义的虚拟货币，可用于平台所有增值服务

---

## 💰 虚拟货币系统设计

### 1. 积分获取方式

| 来源 | 积分数 | 说明 |
|-----|-------|------|
| **订阅会员首次赠送** | 10,000 | 购买幸福岛6年会员立即获得 |
| **订阅会员月度发放** | 500/月 | 6年72个月，共36,000积分 |
| **每日签到** | 10 | 连续签到有加成 |
| **发布文章** | 50 | 每发布一篇文章 |
| **文章被推荐** | 200 | 平台推荐优质文章 |
| **完成每日任务** | 100 | 各类写作任务 |
| **邀请好友** | 500 | 成功邀请一位用户注册 |
| **赚够十万元激励** | 520 | 完成十万元目标奖励 |

**总计可获得积分**：
- 会员订阅：46,000 积分（首次10000 + 72个月×500）
- 额外获取：无上限（通过活跃度获取）

### 2. 积分消费场景

| 服务类型 | 积分消费 | 说明 |
|---------|---------|------|
| **文章深度点评** | 100积分/次 | 专业导师1对1点评 |
| **AI智能润色** | 50积分/次 | AI辅助写作优化 |
| **素材图片下载** | 20积分/张 | 高质量写作素材 |
| **敦煌素材包** | 500积分 | 泡泡柱拍摄的独家素材 |
| **精品课程（入门）** | 200积分 | 写作技巧课程 |
| **精品课程（进阶）** | 500积分 | 进阶写作课程 |
| **一对一私教咨询** | 1000积分/小时 | 资深导师指导 |
| **打赏优质内容** | 自定义 | 支持其他创作者 |

### 3. 积分等级制度

| 等级 | 累计获得积分 | 特权 |
|-----|------------|------|
| LV1 | 0-9,999 | 基础会员 |
| LV2 | 10,000-49,999 | 解锁专属徽章 |
| LV3 | 50,000-99,999 | 每月额外赠送50积分 |
| LV4 | 100,000-199,999 | 优先获得新功能体验资格 |
| LV5 | 200,000+ | 年度荣誉会员 + 专属特权 |

---

## 🎯 会员订阅系统

### 1. 幸福岛6年会员方案

**价格**：¥3999（原价可标 ¥9999）

**订阅时长**：6年（72个月）

**核心权益**：
1. ✅ 个人IP成长双翼
2. ✅ 每日灵感源泉「写作世界素材库」
3. ✅ 深度精进陪伴「写作深交付」
4. ✅ 精准提升指引「写作每周点评」
5. ✅ 同道中人相聚「看世界写作会友」
6. ✅ 平台投稿收益「共建写作生态」
7. ✅ 平台岗位赋能「实战赚时薪」
8. ✅ 6年专属成长档案「万人社群曝光」
9. ✅ 年度免费特训营「聚焦专项提升」
10. ✅ 联名合作·导师级收益升级计划
11. ✅ 写作私教尊享计划
12. ✅ 流量赋能

**积分福利**：
- 首次赠送：10,000 成长积分
- 每月发放：500 积分（自动发放72个月）
- 特别激励：赚够十万元后额外赠送 520 积分

### 2. 订阅生命周期管理

```
购买会员
    ↓
【激活订阅】
    • 订阅状态：active
    • 开始时间：购买时间
    • 结束时间：+6年
    ↓
【首次赠送积分】
    • 立即发放10,000积分
    • 创建积分账户
    ↓
【每月自动发放】（定时任务）
    • 每月1日自动发放500积分
    • 持续72个月
    • 记录发放历史
    ↓
【订阅即将过期】（提前30天提醒）
    • 发送续费提醒
    • 展示会员权益回顾
    ↓
【订阅过期】
    • 订阅状态：expired
    • 积分余额保留（可继续使用）
    • 部分会员权益失效
```

---

## 🏗️ 技术架构

### 后端架构（Spring Boot）

```
com.chengzhang/
├── entity/                    # 实体层
│   ├── User.java             # 用户
│   ├── Subscription.java     # 订阅
│   ├── PointAccount.java     # 积分账户
│   ├── PointTransaction.java # 积分交易记录
│   └── PointService.java     # 积分服务商品
│
├── repository/               # 数据访问层
│   ├── UserRepository.java
│   ├── SubscriptionRepository.java
│   ├── PointAccountRepository.java
│   └── PointTransactionRepository.java
│
├── service/                  # 业务逻辑层
│   ├── AuthService.java      # 认证服务
│   ├── UserService.java      # 用户服务
│   ├── SubscriptionService.java # 订阅服务
│   ├── PointService.java     # 积分服务
│   └── PaymentService.java   # 支付服务
│
├── controller/               # 控制器层
│   ├── AuthController.java   # 认证接口
│   ├── UserController.java   # 用户接口
│   ├── SubscriptionController.java # 订阅接口
│   └── PointController.java  # 积分接口
│
└── dto/                      # 数据传输对象
    ├── RegisterRequest.java
    ├── LoginRequest.java
    ├── UserDTO.java
    └── SubscriptionDTO.java
```

### 数据库表结构

1. **users** - 用户表
2. **subscriptions** - 会员订阅表
3. **point_accounts** - 积分账户表
4. **point_transactions** - 积分交易记录表
5. **subscription_point_grants** - 订阅积分发放记录
6. **point_services** - 积分服务商品表
7. **point_service_orders** - 积分服务消费记录
8. **daily_checkins** - 每日签到表
9. **payment_orders** - 支付订单表

---

## 🔄 核心业务流程

### 1. 用户注册购买流程

```
1. 用户访问落地页
2. 点击"立即购买"
3. 注册账号
4. 选择支付方式
5. 完成支付
6. 自动创建订阅记录
7. 自动发放10,000初始积分
8. 跳转到工作台
```

### 2. 每月积分自动发放（定时任务）

```java
@Scheduled(cron = "0 0 1 1 * ?") // 每月1日凌晨1点执行
public void monthlyPointGrant() {
    // 1. 查询所有有效订阅
    // 2. 检查本月是否已发放
    // 3. 发放500积分
    // 4. 记录发放历史
    // 5. 发送通知
}
```

### 3. 积分消费流程

```
1. 用户选择服务（如：文章点评）
2. 检查积分余额
3. 扣除积分
4. 创建服务订单
5. 记录交易
6. 提供服务
```

---

## 📊 API 接口设计

### 认证相关

```
POST /api/auth/register     # 用户注册
POST /api/auth/login        # 用户登录
POST /api/auth/logout       # 用户登出
GET  /api/auth/me           # 获取当前用户信息
```

### 会员订阅相关

```
GET  /api/subscriptions               # 获取我的订阅列表
POST /api/subscriptions               # 购买会员
GET  /api/subscriptions/:id           # 获取订阅详情
GET  /api/subscriptions/active        # 获取当前有效订阅
```

### 积分相关

```
GET  /api/points/balance              # 获取积分余额
GET  /api/points/transactions         # 获取积分交易记录
POST /api/points/spend                # 消费积分
GET  /api/points/services             # 获取积分服务列表
POST /api/points/checkin              # 每日签到
```

---

## 🎁 会员激励机制

### 1. 十万元激励计划

用户通过平台赚够十万元时：
- 自动赠送 520 成长积分
- 获得专属徽章
- 获得平台推荐曝光机会

### 2. 连续签到奖励

| 连续天数 | 奖励积分 |
|---------|---------|
| 1-6天 | 10积分 |
| 7天 | 50积分（额外） |
| 30天 | 200积分（额外） |
| 365天 | 2000积分（额外） |

### 3. 内容激励

- 文章阅读量每1000次：+20积分
- 文章获得点赞每100个：+10积分
- 文章被收藏：+30积分
- 文章被分享：+50积分

---

## 🚀 实施计划

### Phase 1: 后端开发（当前阶段）
- ✅ 数据库表设计
- ✅ 实体类创建
- ✅ Repository 层创建
- ⏳ Service 层实现
- ⏳ Controller 层实现
- ⏳ JWT 认证实现

### Phase 2: 前端对接
- 更新前端 API 服务
- 实现用户注册/登录
- 实现会员购买流程
- 实现积分系统展示

### Phase 3: 支付集成
- 微信支付集成
- 支付宝支付集成
- 支付回调处理

### Phase 4: 定时任务
- 每月积分自动发放
- 订阅过期检测
- 积分统计报表

---

## 📝 注意事项

1. **数据安全**
   - 密码使用 BCrypt 加密
   - JWT Token 有效期管理
   - 防止积分刷取

2. **性能优化**
   - 积分交易使用事务保证一致性
   - 高频查询使用 Redis 缓存
   - 定时任务使用分布式锁

3. **用户体验**
   - 积分变动实时通知
   - 会员权益清晰展示
   - 订阅到期提前提醒

---

## 📞 后续支持

需要以下功能时联系开发：
- 积分兑换实物礼品
- 积分转赠功能
- 积分排行榜
- 会员等级升级系统
- 更多增值服务
